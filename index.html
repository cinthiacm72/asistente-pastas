<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Asistente Voz Pasta - Wit.ai Vanilla</title>
<style>
  body { font-family: Arial, sans-serif; padding: 2rem; max-width: 600px; margin: auto; }
  button { font-size: 1.2rem; padding: 0.7rem 1.5rem; }
  #status { margin-top: 1rem; font-weight: bold; }
  #response { margin-top: 1rem; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>Asistente de Voz - Pastas</h1>
<button id="startBtn">Iniciar conversación</button>

<div id="status">Presiona "Iniciar conversación" para comenzar</div>
<div id="response"></div>

<script>
(() => {
  const WIT_TOKEN = '72OKU3ULAQHNR3CMRMQ5DVQGKNIUG7LK'; // Tu token Wit.ai

  const startBtn = document.getElementById('startBtn');
  const statusEl = document.getElementById('status');
  const responseEl = document.getElementById('response');

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const isSpeechRecSupported = !!SpeechRecognition;

  // Detectar iOS
  const isIos = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

  let recognition;
  let isListening = false;

  async function sendTextToWit(text) {
    statusEl.textContent = 'Enviando texto a Wit.ai...';

    const url = `https://api.wit.ai/message?v=20230606&q=${encodeURIComponent(text)}`;
    try {
      const res = await fetch(url, {
        headers: { Authorization: `Bearer ${WIT_TOKEN}` }
      });
      if (!res.ok) throw new Error('Error HTTP ' + res.status);
      return await res.json();
    } catch (e) {
      statusEl.textContent = 'Error al conectar con Wit.ai: ' + e.message;
      return null;
    }
  }

  function speak(text) {
    if (!('speechSynthesis' in window)) return;
    const utterance = new SpeechSynthesisUtterance(text);
    window.speechSynthesis.speak(utterance);
  }

  function startSpeechRecognition() {
    if (!isSpeechRecSupported) {
      statusEl.textContent = 'Tu navegador no soporta reconocimiento de voz.';
      return;
    }

    if (isListening) {
      recognition.stop();
      return;
    }

    recognition = new SpeechRecognition();
    recognition.lang = 'es-ES';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = () => {
      isListening = true;
      startBtn.textContent = 'Detener escucha';
      statusEl.textContent = 'Escuchando...';
      responseEl.textContent = '';
    };

    recognition.onresult = async (event) => {
      const text = event.results[0][0].transcript;
      statusEl.textContent = `Reconocido: "${text}"`;
      const witResponse = await sendTextToWit(text);
      if (witResponse) handleWitResponse(witResponse);
    };

    recognition.onerror = (event) => {
      statusEl.textContent = `Error: ${event.error}`;
      isListening = false;
      startBtn.textContent = 'Iniciar conversación';
    };

    recognition.onend = () => {
      isListening = false;
      startBtn.textContent = 'Iniciar conversación';
      statusEl.textContent = 'Escucha finalizada';
    };

    recognition.start();
  }

  function handleWitResponse(data) {
    console.log('Wit.ai response:', data);
    const text = data.text || '';
    let intent = null;
    if (data.intents && data.intents.length > 0) {
      intent = data.intents[0].name;
    }

    responseEl.textContent = `Intención: ${intent || 'No detectada'}\nTexto: ${text}`;

    let answer = '';
    if (intent === 'about_brand') {
      answer = 'Somos una marca dedicada a las mejores pastas italianas artesanales.';
    } else if (intent === 'get_recipe') {
      answer = 'Aquí tienes una receta fácil: Pasta con salsa de tomate y albahaca.';
    } else {
      answer = 'Lo siento, no entendí tu pregunta. ¿Puedes repetir?';
    }

    responseEl.textContent += `\n\nRespuesta: ${answer}`;
    speak(answer);
  }

  startBtn.addEventListener('click', () => {
    if (!isSpeechRecSupported) {
      statusEl.textContent = 'Tu navegador no soporta reconocimiento de voz.';
      return;
    }

    if (isIos && !isSpeechRecSupported) {
      statusEl.textContent = 'Reconocimiento de voz no soportado en esta versión de iOS.';
      return;
    }

    startSpeechRecognition();
  });
})();
</script>

</body>
</html>



<!-- <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Asistente de Pastas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  
  <div class="container">
    <img src="https://www.shutterstock.com/image-vector/silhouette-monochrome-dish-hot-spaghetti-260nw-520318474.jpg" alt="Logo de Asistente Pastas" class="logo" />
    <h1>Asistente de Pastas Italianas</h1>
    <p>Presiona el botón y háblame. Por ejemplo: <em>"¿Qué productos ofrecen?"</em> o <em>"Sugiéreme una receta con fettuccine."</em></p>
    
    <button id="hablarBtn">🎤 Hablar</button>
    
    <div class="respuesta" id="respuesta"></div>
  </div>

  <script src="main.js"></script>
</body>
</html> -->
